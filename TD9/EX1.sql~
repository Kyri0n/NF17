SELECT facture.num,client.nom,client.prenom, produit.designation, produit.prix, ligne_fact.qte
FROM ligne_fact, client, facture, produit 
WHERE ligne_fact.facture = facture.num 
AND ligne_fact.produit = produit.num 
AND facture.client = client.num
ORDER BY facture.num;

SELECT f.num, sum(LF.qte*p.prix)
FROM ligne_fact LF, facture F, produit P
WHERE lf.facture = f.num
AND p.num = lf.produit
GROUP BY f.num
ORDER BY f.num;

ex2

SELECT cl.num, cl.nom, cl.prenom, NVL(sum(lf.qte*p.prix),0) as total,
CASE WHEN sum(lf.qte*p.prix) > 500 THEN 'VIP' 
     WHEN sum(lf.qte*p.prix) > 50 THEN 'client ordinaire'
     ELSE 'client à potentiel' END AS Cat
FROM (((client cl FULL OUTER JOIN facture f on f.client = cl.num) 
                  FULL OUTER JOIN ligne_fact lf on lf.facture = f.num)
                  FULL OUTER JOIN produit p on p.num = lf.produit)
               
GROUP BY cl.num,cl.nom, cl.prenom
ORDER BY cl.num;


CREATE view v_chiffre_affaire
(code_client, nom, prenom, chiffre_affaire, cat)
AS SELECT cl.num, cl.nom, cl.prenom, NVL(sum(lf.qte*p.prix),0),
     CASE WHEN sum(lf.qte*p.prix) > 500 THEN 'VIP' 
     WHEN sum(lf.qte*p.prix) > 50 THEN 'client ordinaire'
     ELSE 'client à potentiel' END AS Cat
   FROM (((client cl FULL OUTER JOIN facture f on f.client = cl.num) 
                  FULL OUTER JOIN ligne_fact lf on lf.facture = f.num)
                  FULL OUTER JOIN produit p on p.num = lf.produit)
   GROUP BY cl.num,cl.nom, cl.prenom
   ORDER BY cl.num;

SELECT * FROM v_chiffre_affaire
WHERE nom=lower('morin');
